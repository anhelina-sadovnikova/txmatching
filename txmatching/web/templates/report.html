<html>
<head>
  <title>{{ title }}</title>
  <style>

    html {
      margin: 20px;
      font-size: 13px;
      font-family: Arial, Helvetica, sans-serif;
    }

    table {
      border-collapse: collapse;
      margin: 5px;
      width: 100%;
    }

    table, th, td {
      border: 1px solid black;
      padding: 5px;
    }

    .no-border-table {
      border: none;
    }

    .header {
      font-size: 29px;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .caption {
      font-weight: bold;
      font-size: 23px;
      margin-top: 20px;
      margin-bottom: 20px;
    }

    .caption-matching {
      font-weight: bold;
      font-size: 20px;
      margin-top: 20px;
      margin-bottom: 20px;
    }

    .caption-donors-and-recipients {
      font-weight: bold;
      font-size: 17px;
      margin-top: 20px;
      margin-bottom: 20px;
    }

    .table-header {
      background-color: #e6e6e6;
      font-weight: bold;
    }

  </style>
</head>
<body>
<div>
  <div class="header">{{ title }}</div>
  <table class="no-border-table">
    <tr>
      <td class="no-border-table">Generated</td>
      <td class="no-border-table">{{ date }}</td>
    </tr>
  </table>
</div>
<div>
  <div class="caption">Configuration</div>
  <table>
    <tr>
      <td class="table-header">Enforce compatible blood group</td>
      <td>{{ configuration.enforce_compatible_blood_group }}</td>
    </tr>
    <tr>
      <td class="table-header">Minimum total score</td>
      <td>{{ configuration.minimum_total_score }}</td>
    </tr>
    <tr>
      <td class="table-header">Maximum total score</td>
      <td>{{ configuration.maximum_total_score }}</td>
    </tr>
    <tr>
      <td class="table-header">Require new donor having better match in compatibility index</td>
      <td>{{ configuration.require_new_donor_having_better_match_in_compatibility_index }}</td>
    </tr>
    <tr>
      <td class="table-header">Require new donor having better match in compatibility index or blood group</td>
      <td>{{ configuration.require_new_donor_having_better_match_in_compatibility_index_or_blood_group }}</td>
    </tr>
    <tr>
      <td class="table-header">Blood group compatibility bonus</td>
      <td>{{ configuration.blood_group_compatibility_bonus }}</td>
    </tr>
    <tr>
      <td class="table-header">Use binary scoring</td>
      <td>{{ configuration.use_binary_scoring }}</td>
    </tr>
    <tr>
      <td class="table-header">Max cycle length</td>
      <td>{{ configuration.max_cycle_length }}</td>
    </tr>
    <tr>
      <td class="table-header">Max sequence length</td>
      <td>{{ configuration.max_sequence_length }}</td>
    </tr>
    <tr>
      <td class="table-header">Max number of distinct countries in round</td>
      <td>{{ configuration.max_number_of_distinct_countries_in_round }}</td>
    </tr>
    <tr>
      <td class="table-header">Required patient db ids</td>
      <td>{{ configuration.required_patient_db_ids|join(', ') }}</td>
    </tr>
    <tr>
      <td class="table-header">Allow low high res incompatible</td>
      <td>{{ configuration.allow_low_high_res_incompatible }}</td>
    </tr>
    <tr>
      <td class="table-header">Forbidden country combinations</td>
      <td>{{ configuration.forbidden_country_combinations|map('country_combination_filter')|join(', ') }}</td>
    </tr>
    <tr>
      <td class="table-header">Manual donor recipient scores</td>
      <td>{{ configuration.manual_donor_recipient_scores|map('donor_recipient_score_filter')|join(', ') }}</td>
    </tr>
  </table>
</div>
<div>
  <div class="caption">Matchings</div>
  {% for matching in matchings %}
    <div class="caption-matching">Matching {{ matching.id() }}</div>
    <table class="no-border-table">
      <tr>
        <td class="no-border-table">score</td>
        <td class="no-border-table">{{ matching.score() }}</td>
      </tr>
      <tr>
        <td class="no-border-table" colspan="2">
          <div class="caption-donors-and-recipients">Donors and Recipients</div>
        </td>
      </tr>
      <tr>
        <table>
          {% for donor_and_recipient in matching.donor_recipient_list %}
            <tr>
              <td class="table-header"></td>
              <td class="table-header">Donor</td>
              <td class="table-header">Recipient</td>
            </tr>
            <tr>
              <td class="table-header">Medical id</td>
              <td>{{ donor_and_recipient[0].medical_id }}</td>
              <td>{{ donor_and_recipient[1].medical_id }}</td>
            </tr>
            <tr>
              <td class="table-header">Acceptable blood groups</td>
              <td>{{ donor_and_recipient[0].parameters.acceptable_blood_groups|join(', ') }}</td>
              <td>{{ donor_and_recipient[1].parameters.acceptable_blood_groups|join(', ') }}</td>
            </tr>
            <tr>
              <td class="table-header">Blood group</td>
              <td>{{ donor_and_recipient[0].parameters.blood_group }}</td>
              <td>{{ donor_and_recipient[1].parameters.blood_group }}</td>
            </tr>
            <tr>
              <td class="table-header">Country code</td>
              <td>{{ donor_and_recipient[0].parameters.country_code }}</td>
              <td>{{ donor_and_recipient[1].parameters.country_code }}</td>
            </tr>
            <tr>
              <td class="table-header">Hla antibodies</td>
              <td>{{ donor_and_recipient[0].parameters.hla_antibodies.codes|join(', ') }}</td>
              <td>{{ donor_and_recipient[1].parameters.hla_antibodies.codes|join(', ') }}</td>
            </tr>
            <tr>
              <td class="table-header">Hla antibodies broad resolution</td>
              <td>{{ donor_and_recipient[0].parameters.hla_antibodies_broad_resolution|join(', ') }}</td>
              <td>{{ donor_and_recipient[1].parameters.hla_antibodies_broad_resolution|join(', ') }}</td>
            </tr>
            <tr>
              <td class="table-header">Hla antigens</td>
              <td>{{ donor_and_recipient[0].parameters.hla_antigens.codes|join(', ') }}</td>
              <td>{{ donor_and_recipient[1].parameters.hla_antigens.codes|join(', ') }}</td>
            </tr>
            <tr>
              <td class="table-header">Hla antigens broad resolution</td>
              <td>{{ donor_and_recipient[0].parameters.hla_antigens_broad_resolution|join(', ') }}</td>
              <td>{{ donor_and_recipient[1].parameters.hla_antigens_broad_resolution|join(', ') }}</td>
            </tr>
          {% endfor %}
        </table>
      </tr>
    </table>
  {% endfor %}
</div>
</body>
</html>